<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    

	<mapper namespace="com.kiosk.app.infra.option.OptionMapper">
	
		<resultMap type="com.kiosk.app.infra.option.Option" id="resultMapObj"></resultMap>
	 
	 	<sql id="optionTable">
	 		seq,
	 		optionName,
	 		optionPrice,
	 		menuSeq
	 	</sql>
	 
	    <sql id ="selectCommon">
	   		FROM    
		    	option
			WHERE 1=1
				<if test="shKeyword != null and !shKeyword.equals('')">AND categoryName LIKE CONCAT('%',#{shKeyword},'%')</if>
	    </sql>
	
	   	<select id="selectOneCount" resultType="Integer">
			SELECT count(*)
			<include refid="selectCommon" />
		</select>
	
	   	<select id="selectList" resultMap="resultMapObj">
			SELECT aa.* FROM (   	
		   		SELECT
					<include refid="optionTable" />
		   			<include refid="selectCommon" />
			) aa
			LIMIT #{rowNumToShow} OFFSET #{startRnumForMysql}	   			
	   	</select>
	 
	 
	 
	 	
	 		<select id="selectOne" resultMap="resultMapObj">
	 		select
	 			<include refid="optionTable" />
	 		from
	 			option
	 		where 1=1
	 			and	seq = #{seq}
	 			<!-- 문자 검색은 대부분 like를 사용 -->
	 	
	 	
	 	</select>
	 	
	 <update id="update" >
	 	update
	 		option
	 	set
	 		optionName = #{optionName}
	 	where 1=1
	 		and seq = #{seq}
	 </update>
	 
	 <delete id="delete">
	 	delete
	 	from
	 		option
	 	where 1=1
	 		and seq = #{seq}
	 </delete>
	 
	 <insert id="insert">
	 	insert into 
	 	menu(
	 		optionName,
	 		optionPrice,
			menuSeq
	 		)value(
	 			#{optionName},
			 <choose>
	            <when test="menuSeq == null or menuSeq == '' or menuSeq == 0">
	                1
	            </when>
	            <when test="menuSeq == '1' or menuSeq == 1 ">
	                1
	            </when>
	            <otherwise>
	                <![CDATA[(SELECT 1/0)]]>
	            </otherwise>
	        </choose>
	 	
	 		)
	 
	 </insert>
	 	
	 <update id="uelete">
		update
	 		option
	 	set
	 		menuSeq = #{menuSeq}
	 	where 1=1
	 		and seq = #{seq} 
	 </update>
	 </mapper>
